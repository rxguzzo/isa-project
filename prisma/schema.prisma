// prisma/schema.prisma
generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql" // Confirmando que agora é PostgreSQL
  url      = env("DATABASE_URL")
}

// O usuário que faz o login. Pode ser um usuário normal ou um admin.
model Usuario {
  id        String    @id @default(cuid())
  email     String    @unique
  senha     String
  nome      String?
  role      String    @default("USER") // Papel: 'USER' ou 'ADMIN'
  createdAt DateTime  @default(now())
  updatedAt DateTime  @updatedAt

  empresas  Empresa[] // Um usuário pode ter várias empresas
}

// A empresa agora pertence a um usuário.
model Empresa {
  id            String    @id @default(cuid())
  razaoSocial   String
  cnpj          String?   @unique // CNPJ opcional e único
  createdAt     DateTime  @default(now())
  updatedAt     DateTime  @updatedAt

  usuarioId     String
  usuario       Usuario   @relation(fields: [usuarioId], references: [id])

  problemas     Problema[]
}

model Problema {
  id                      String    @id @default(cuid())
  areaDemanda             String[]  // Agora podemos usar array com PostgreSQL!
  assunto                 String
  descricao               String
  objetivos               String?
  nivelUrgencia           String
  orcamento               String?
  comoConheceu            String?
  consentimentoLGPD       Boolean   @default(false)
  disponibilidadeVisita   Boolean   @default(false)
  status                  String    @default("aberto")
  createdAt               DateTime  @default(now())
  updatedAt               DateTime  @updatedAt
  empresaId               String
  empresa                 Empresa   @relation(fields: [empresaId], references: [id])
}